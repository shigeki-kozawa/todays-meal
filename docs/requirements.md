# 今日のご飯アプリ - 要件定義書

## 1. プロジェクト概要

### 1.1 目的
ユーザーが「今日何を食べるか」を決める手助けをするAIチャットアプリケーション

### 1.2 主要機能
- AIエージェントとの対話形式でメニューを決定
- 家にある食材からレシピを提案
- レシピの保存・お気に入り機能
- 過去の履歴表示

---

## 2. 技術スタック

### 2.1 フロントエンド
- **React 18** + **TypeScript**
- **Vite** (ビルドツール)
- **TailwindCSS** (スタイリング)

### 2.2 バックエンド
- **Node.js** + **Express**
- **LangChain.js** (LLMフレームワーク)
- **LangGraph.js** (エージェントワークフロー)
- **LangSmith** (モニタリング・デバッグ)

### 2.3 AI/LLM
- **Google Gemini** (gemini-1.5-flash または gemini-1.5-pro)

### 2.4 データ永続化
- **LocalStorage** (ローカル開発用)
- 将来的にはデータベース（PostgreSQL等）に移行可能

---

## 3. 機能要件

### 3.1 チャット機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| 初期メッセージ | エージェントが「今日何食べたい？」と質問して開始 | 必須 |
| 食材入力 | ユーザーが食材を入力すると、レシピを提案 | 必須 |
| メニュー提案 | 入力に基づいてレシピを複数提案 | 必須 |
| 詳細レシピ表示 | 選択したレシピの詳細（材料、手順）を表示 | 必須 |

### 3.2 レシピ情報
| 情報 | 説明 | 優先度 |
|------|------|--------|
| 料理名 | レシピの名前 | 必須 |
| 材料リスト | 必要な材料と分量 | 必須 |
| 調理手順 | ステップバイステップの手順 | 必須 |
| 調理時間 | 目安の調理時間 | 必須 |
| カロリー | 概算カロリー | 必須 |
| 栄養素 | タンパク質、脂質、炭水化物など | 任意 |

### 3.3 フィルタリング・ソート機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| 調理時間フィルター | 指定時間以内のレシピを絞り込み | 必須 |
| カロリーソート | カロリー順でソート | 必須 |

### 3.4 保存機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| お気に入り保存 | レシピをお気に入りに追加 | 必須 |
| お気に入り一覧 | 保存したレシピの一覧表示 | 必須 |
| 履歴表示 | 過去の会話・提案履歴を表示 | 必須 |

---

## 4. 画面構成

### 4.1 メイン画面（チャット画面）
```
┌─────────────────────────────────────┐
│  🍳 今日のご飯                  [履歴] │
├─────────────────────────────────────┤
│                                     │
│  🤖 今日何食べたい？                │
│                                     │
│                    冷蔵庫に卵と     │
│                    豚肉があるよ 👤  │
│                                     │
│  🤖 いいですね！以下のレシピは      │
│     いかがですか？                  │
│     1. 豚の生姜焼き (25分)          │
│     2. 親子丼 (20分)                │
│     3. オムレツ (15分)              │
│                                     │
├─────────────────────────────────────┤
│  [入力欄...                ] [送信] │
└─────────────────────────────────────┘
```

### 4.2 レシピ詳細モーダル
```
┌─────────────────────────────────────┐
│  豚の生姜焼き            [♡] [✕]   │
├─────────────────────────────────────┤
│  ⏱️ 25分  🔥 450kcal               │
├─────────────────────────────────────┤
│  【材料】                           │
│  ・豚ロース肉 200g                  │
│  ・生姜 1かけ                       │
│  ・醤油 大さじ2 ...                 │
├─────────────────────────────────────┤
│  【手順】                           │
│  1. 豚肉を食べやすい大きさに切る    │
│  2. 生姜をすりおろす ...            │
└─────────────────────────────────────┘
```

### 4.3 お気に入り・履歴画面
```
┌─────────────────────────────────────┐
│  [お気に入り] [履歴]                │
├─────────────────────────────────────┤
│  📌 豚の生姜焼き      25分 450kcal  │
│  📌 親子丼            20分 550kcal  │
│  📌 カレーライス      45分 700kcal  │
└─────────────────────────────────────┘
```

---

## 5. AIエージェント設計

### 5.1 LangGraph ワークフロー
```
[開始] → [挨拶・質問] → [ユーザー入力待ち]
                              ↓
                        [入力解析]
                              ↓
              ┌───────────────┴───────────────┐
              ↓                               ↓
        [食材からレシピ検索]           [気分からレシピ提案]
              ↓                               ↓
              └───────────────┬───────────────┘
                              ↓
                      [レシピ生成]
                              ↓
                      [結果表示]
                              ↓
                    [追加質問/終了]
```

### 5.2 エージェントの役割
1. **会話管理**: ユーザーとの対話を自然に進行
2. **意図理解**: ユーザーの入力から意図を把握
3. **レシピ生成**: 条件に合ったレシピを生成
4. **栄養計算**: カロリー・栄養素の概算

---

## 6. API設計

### 6.1 エンドポイント
| メソッド | パス | 説明 |
|----------|------|------|
| POST | /api/chat | チャットメッセージ送信 |
| GET | /api/favorites | お気に入り一覧取得 |
| POST | /api/favorites | お気に入り追加 |
| DELETE | /api/favorites/:id | お気に入り削除 |
| GET | /api/history | 履歴一覧取得 |

### 6.2 チャットリクエスト例
```json
{
  "message": "冷蔵庫に卵と豚肉があるよ",
  "conversationId": "conv_123",
  "filters": {
    "maxCookingTime": 30
  }
}
```

### 6.3 チャットレスポンス例
```json
{
  "message": "いいですね！以下のレシピはいかがですか？",
  "recipes": [
    {
      "id": "recipe_1",
      "name": "豚の生姜焼き",
      "cookingTime": 25,
      "calories": 450,
      "nutrition": {
        "protein": 25,
        "fat": 20,
        "carbs": 30
      },
      "ingredients": [...],
      "steps": [...]
    }
  ],
  "conversationId": "conv_123"
}
```

---

## 7. 環境変数

```env
# Google Gemini
GOOGLE_API_KEY=your_gemini_api_key

# LangSmith (オプション)
LANGCHAIN_TRACING_V2=true
LANGCHAIN_API_KEY=your_langsmith_api_key
LANGCHAIN_PROJECT=todays-meal

# サーバー設定
PORT=3001
```

---

## 8. 開発フェーズ

### Phase 1: 基盤構築 (今回)
- [x] プロジェクト初期設定
- [ ] React フロントエンド構築
- [ ] Express バックエンド構築
- [ ] LangChain/LangGraph 設定
- [ ] 基本チャット機能

### Phase 2: コア機能
- [ ] レシピ生成機能
- [ ] 食材からのレシピ提案
- [ ] カロリー・栄養素表示

### Phase 3: 拡張機能
- [ ] お気に入り機能
- [ ] 履歴機能
- [ ] フィルタリング・ソート

### Phase 4: 改善
- [ ] UI/UX改善
- [ ] エラーハンドリング強化
- [ ] パフォーマンス最適化

---

## 9. 確認事項

この要件定義書について、以下の点を確認させてください：

1. **レシピデータ**: Google Gemini でレシピを生成する方式で進めてよいですか？
2. **デザイン**: 上記の画面構成で問題ないですか？
3. **機能優先度**: Phase分けは適切ですか？
4. **その他**: 追加したい機能や変更点はありますか？

---

*最終更新: 2024年12月12日*

